## 页面埋点
- PV / UV
- 停留时长 
- 流量来源
- 用户交互

分类：
- 手写埋点：自主选择需要监控的数据然后在相应的地方写入代码。这种方式的灵活性很大，但是唯一的缺点就是工作量较大，每个需要监控的地方都得插入代码
- 无埋点：统计所有的事件并且定时上报。这种方式虽然没有前一种方式繁琐了，但是因为统计的是所有事件，所以还需要后期过滤出需要的数据
 
## 性能监控
对于性能监控来说，其实我们只需要调用 `performance.getEntriesByType('navigation')` 这行代码就行了

## 性能优化

### 资源

- 减少http请求次数和传输报文大小
- CSS Sprite（雪碧图，图片精灵）技术
- 图片懒加载（延迟加载）技术
- 音视频文件取消预加载（preload='none'），可以增加第一次渲染页面的速度，需要播放的时候在加载
- 客户端和服务器端的数据传输尽可能基于JSON格式完成，XML格式比JSON格式要大一些
- 把页面中的CSS/JS/图片等文件进行合并压缩
- 图片地图：对于多次调取使用的图片（背景图），尽可能把它提取成公共样式，而不是重新设置background
- 图片Base64 用base64码代表图片，减少http请求，增加浏览器渲染速度 但是代码恶心针对一些个别的加载速度很慢的图片可以使用

### 网络
- 把不经常更改的静态资源（js库、图片等）做缓存处理（一般做的是304或者Etag等协商缓存）
- DNS缓存或者预处理（DNS Prefetch），减少DNS的查找
- 设置本地的离线存储（Manifest）或者把一些不经常更改的数据做本地临时存储（webstorage、indexdb）等
- 部署CDN（地域分布式服务器或者增加服务器）
- 建立 Connection:keep-alive TCP长连接 和 Cache-Control 和 Expires Http的强缓存
- 使用http2版本协议（好处：可以多条TCP通道共存 => 管道化链接）
- 一个项目分为不同的服务器。例如：资源web服务器、数据服务器、图片服务器、视频服务器、等，合理利用服务器资源，但是会导致过多的DNS解析

### 代码
- 减少直接对DOM（减少DOM的回流和重绘），当代项目基本上都是基于MVVM/MVC数据驱动视图渲染，对DOM的操作框架会通过虚拟DOM进行DOM Diff 精确渲染，性能要高效很多
- 减少对闭包的使用，过多的使用闭包会产生很多不销毁的内存，处理不当会导致内存溢出“栈溢出”
- 对于动画来说：能用CSS解决的不用JS（能够用transform处理不使用传统css样式，transform会开启硬件加速，不会引发回流），能用reaquestAnimationFrame解决的不用定时器
- 避免使用iframe：iframe会嵌入其他页面，会吧嵌入的页面也渲染了
- 低耦合高内聚（基于封装的方式减少页面中的冗余代码，提高代码使用率）
- 尽可能使用事件委托
- 避免出现死循环或者嵌套循环
- 项目中尽可能使用异步编程来模拟出多线程的效果，避免主线程阻塞（异步操作基于Promise设计模式来管理）
- JS中不要使用 with （不知道是什么 但是性能特别差）
- 避免使用CSS表达式
- 函数的防抖和节流
- 减少使用eval（主要原因是防止压缩代码的时候，由于符号书写不规范导致代码混乱） 性能消耗可忽略不计
- 减少filter滤镜的使用
- 尽可能减少table布局
- 尽可能减少选择器的层级（选择器是从右向左解析）
- 手动回收堆栈内存（赋值为null）